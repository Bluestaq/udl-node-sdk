// File generated from our OpenAPI spec by Stainless. See CONTRIBUTING.md for details.

import { isJqError, maybeFilter } from 'unified-data-library-mcp/filtering';
import { Metadata, asErrorResult, asTextContentResult } from 'unified-data-library-mcp/tools/types';

import { Tool } from '@modelcontextprotocol/sdk/types.js';
import Unifieddatalibrary from 'unified-data-library';

export const metadata: Metadata = {
  resource: 'observations.obscorrelation.history',
  operation: 'read',
  tags: [],
  httpMethod: 'get',
  httpPath: '/udl/obscorrelation/history',
};

export const tool: Tool = {
  name: 'list_obscorrelation_observations_history',
  description:
    "When using this tool, always use the `jq_filter` parameter to reduce the response size and improve performance.\n\nOnly omit if you're sure you don't need the data.\n\nService operation to dynamically query historical data by a variety of query parameters not specified in this API documentation. See the queryhelp operation (/udl/&lt;datatype&gt;/queryhelp) for more details on valid/required query parameter information.\n\n# Response Schema\n```json\n{\n  type: 'array',\n  items: {\n    $ref: '#/$defs/history_list_response'\n  },\n  $defs: {\n    history_list_response: {\n      type: 'object',\n      description: 'Model representation supporting post-pass correlation of UCTs and re-correlation of mis-tagged electro-optical (EO), radar, RF, and DOA track/observations.',\n      properties: {\n        classificationMarking: {\n          type: 'string',\n          description: 'Classification marking of the data in IC/CAPCO Portion-marked format.'\n        },\n        corrType: {\n          type: 'string',\n          description: 'Indicator of whether the type of correlation is OBSERVATION or TRACK:\\nOBSERVATION: Identifies an observation is being correlated.\\nTRACK: Identifies the entire track of observations is being correlated.',\n          enum: [            'OBSERVATION',\n            'TRACK'\n          ]\n        },\n        dataMode: {\n          type: 'string',\n          description: 'Indicator of whether the data is EXERCISE, REAL, SIMULATED, or TEST data:\\n\\nEXERCISE:&nbsp;Data pertaining to a government or military exercise. The data may include both real and simulated data.\\n\\nREAL:&nbsp;Data collected or produced that pertains to real-world objects, events, and analysis.\\n\\nSIMULATED:&nbsp;Synthetic data generated by a model to mimic real-world datasets.\\n\\nTEST:&nbsp;Specific datasets used to evaluate compliance with specifications and requirements, and for validating technical, functional, and performance characteristics.',\n          enum: [            'REAL',\n            'TEST',\n            'SIMULATED',\n            'EXERCISE'\n          ]\n        },\n        msgTs: {\n          type: 'string',\n          description: 'Correlation message generation time, in ISO 8601 UTC format with millisecond precision.',\n          format: 'date-time'\n        },\n        obId: {\n          type: 'string',\n          description: 'Identifier of the Observation associated with this Correlation. If corrType=TRACK then this field should reference the first Observation in the track. Note: To retrieve all remaining Observations in the track, the GET query should include this Observation\\'s source and origin field values, along with the trackId.'\n        },\n        obType: {\n          type: 'string',\n          description: 'Indicator of whether the type of Observation(s) being correlated is DOA, EO, PASSIVE_RADAR, RADAR, RF, SAR, or SOISET:\\nDOA: The observation type being correlated is Difference of Arrival.\\nEO: The observation type being correlated is Electro-Optical.\\nPASSIVE_RADAR: The observation type being correlated is Passive Radar.\\nRADAR: The observation type being correlated is Radar.\\nRF: The observation type being correlated is Radio Frequency.\\nSAR: The observation type being correlated is Synthetic Aperture Radar.\\nSOISET: The observation type being correlated is Space Object Identification Observation Set.',\n          enum: [            'DOA',\n            'EO',\n            'PASSIVE_RADAR',\n            'RADAR',\n            'RF',\n            'SAR',\n            'SOISET'\n          ]\n        },\n        referenceOrbitId: {\n          type: 'string',\n          description: 'Identifier of the orbit state used for correlation.'\n        },\n        referenceOrbitType: {\n          type: 'string',\n          description: 'Indicator of whether the reference orbit type used for correlation is an ELSET, ESID, or SV:\\nELSET: The reference orbit type is an Element Set.\\nESID: The reference orbit type is an Ephemeris Set.\\nSV: The reference orbit type is a State Vector.',\n          enum: [            'ELSET',\n            'ESID',\n            'SV'\n          ]\n        },\n        source: {\n          type: 'string',\n          description: 'Source of the data.'\n        },\n        id: {\n          type: 'string',\n          description: 'Unique identifier of the record, auto-generated by the system.'\n        },\n        algorithmCorrType: {\n          type: 'string',\n          description: 'Type of algorithm used for this correlation (e.g. ROTAS, GEOMETRIC, STATISTICAL, MAHALANOBIS, AI/ML, OTHER).'\n        },\n        altCatalog: {\n          type: 'string',\n          description: 'Name of the alternate catalog.'\n        },\n        altNamespace: {\n          type: 'string',\n          description: 'Associates one or more alternate catalogs with a source provider or system. Namespaces may be defined by their respective data providers or systems (e.g. JCO, 18SDS, EOSSS, EXO, KBR, KRTL, LeoLabs, NorthStar, SAFRAN, Slingshot).'\n        },\n        altObjectId: {\n          type: 'string',\n          description: 'Alternate unique object ID within the namespace.'\n        },\n        altUct: {\n          type: 'boolean',\n          description: 'Boolean indicating whether the observation or track can be correlated to the alternate object specified under altObjectId. This flag should only be set to true by data providers after an attempt to correlate to an on-orbit object was made and failed. If unable to correlate, the \\'origObjectId\\' field may be populated with an internal data provider specific identifier.'\n        },\n        astat: {\n          type: 'integer',\n          description: 'Astrostandard ROTAS correlation result (0 - 4), if applicable.  Refer to ROTAS documentation for an explanation of ASTAT values.'\n        },\n        corrQuality: {\n          type: 'number',\n          description: 'Correlation score ranging from 0.0 to 1.0. A score of 1.0 represents perfect correlation to the orbit of the corresponding satellite, such as when all observation residuals equal 0.'\n        },\n        createdAt: {\n          type: 'string',\n          description: 'Time the row was created in the database, auto-populated by the system.',\n          format: 'date-time'\n        },\n        createdBy: {\n          type: 'string',\n          description: 'Application user who created the row in the database, auto-populated by the system.'\n        },\n        idOnOrbit: {\n          type: 'string',\n          description: 'Identifier of the correlated target on-orbit object, if associated with a valid satNo.'\n        },\n        idParentCorrelation: {\n          type: 'string',\n          description: 'Identifier of the ObsCorrelation record from which this ObsCorrelation record originated. This behavior allows for different source providers/systems to make changes to a given correlation and maintain traceability back to the original correlation.'\n        },\n        origin: {\n          type: 'string',\n          description: 'Originating system or organization which produced the data, if different from the source. The origin may be different than the source if the source was a mediating system which forwarded the data on behalf of the origin system. If null, the source may be assumed to be the origin.'\n        },\n        origNetwork: {\n          type: 'string',\n          description: 'The originating source network on which this record was created, auto-populated by the system.'\n        },\n        origObjectId: {\n          type: 'string',\n          description: 'Optional identifier indicates the target on-orbit object being correlated. This may be an internal identifier and not necessarily a valid satellite number.'\n        },\n        satNo: {\n          type: 'integer',\n          description: 'Current 18th SDS satellite/catalog number of the target on-orbit object. Useful to know in the case where an observation is correlated to another satellite/catalog number.'\n        },\n        sourceDL: {\n          type: 'string',\n          description: 'The source data library from which this record was received. This could be a remote or tactical UDL or another data library. If null, the record should be assumed to have originated from the primary Enterprise UDL.'\n        },\n        tags: {\n          type: 'array',\n          description: 'Optional array of provider/source specific tags for this data, where each element is no longer than 32 characters, used for implementing data owner conditional access controls to restrict access to the data. Should be left null by data providers unless conditional access controls are coordinated with the UDL team.',\n          items: {\n            type: 'string'\n          }\n        },\n        trackId: {\n          type: 'string',\n          description: 'Identifier of the Track associated with this ObsCorrelation.'\n        },\n        transactionId: {\n          type: 'string',\n          description: 'Optional identifier to track a commercial or marketplace transaction executed to produce this data.'\n        }\n      },\n      required: [        'classificationMarking',\n        'corrType',\n        'dataMode',\n        'msgTs',\n        'obId',\n        'obType',\n        'referenceOrbitId',\n        'referenceOrbitType',\n        'source'\n      ]\n    }\n  }\n}\n```",
  inputSchema: {
    type: 'object',
    properties: {
      msgTs: {
        type: 'string',
        description:
          'Correlation message generation time, in ISO 8601 UTC format with millisecond precision. (YYYY-MM-DDTHH:MM:SS.sssZ)',
        format: 'date-time',
      },
      columns: {
        type: 'string',
        description:
          'optional, fields for retrieval. When omitted, ALL fields are assumed. See the queryhelp operation (/udl/&lt;datatype&gt;/queryhelp) for more details on valid query fields that can be selected.',
      },
      firstResult: {
        type: 'integer',
      },
      maxResults: {
        type: 'integer',
      },
      jq_filter: {
        type: 'string',
        title: 'jq Filter',
        description:
          'A jq filter to apply to the response to include certain fields. Consult the output schema in the tool description to see the fields that are available.\n\nFor example: to include only the `name` field in every object of a results array, you can provide ".results[].name".\n\nFor more information, see the [jq documentation](https://jqlang.org/manual/).',
      },
    },
    required: ['msgTs'],
  },
  annotations: {
    readOnlyHint: true,
  },
};

export const handler = async (client: Unifieddatalibrary, args: Record<string, unknown> | undefined) => {
  const { jq_filter, ...body } = args as any;
  const response = await client.observations.obscorrelation.history.list(body).asResponse();
  try {
    return asTextContentResult(await maybeFilter(jq_filter, await response.json()));
  } catch (error) {
    if (error instanceof Unifieddatalibrary.APIError || isJqError(error)) {
      return asErrorResult(error.message);
    }
    throw error;
  }
};

export default { metadata, tool, handler };
